<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>âš½ 2äººã‚µãƒƒã‚«ãƒ¼ã‚²ãƒ¼ãƒ </title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
    body {
      background: #1a1a2e;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100dvh;
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
      overflow: hidden;
    }
    h1 {
      font-size: clamp(1rem, 4vw, 1.8rem);
      margin: 6px 0 2px;
      text-shadow: 0 0 20px #00ff88;
      letter-spacing: 2px;
    }
    .score-board {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 4px;
      font-size: clamp(0.9rem, 3vw, 1.2rem);
      font-weight: bold;
    }
    .score-board .p1-score { color: #4fc3f7; font-size: clamp(1.4rem, 5vw, 2.2rem); }
    .score-board .p2-score { color: #ef9a9a; font-size: clamp(1.4rem, 5vw, 2.2rem); }
    .score-board .vs { color: #888; font-size: clamp(0.7rem, 2.5vw, 1rem); }

    /* ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒ©ãƒƒãƒ‘ãƒ¼ */
    #game-wrap {
      position: relative;
      width: 100%;
      max-width: 800px;
    }
    canvas {
      display: block;
      width: 100%;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 0 30px rgba(0,255,136,0.25);
    }

    /* Dãƒ‘ãƒƒãƒ‰å…±é€š */
    .dpad {
      position: absolute;
      bottom: 8px;
      display: grid;
      grid-template-areas:
        ". up ."
        "left mid right"
        ". down .";
      grid-template-columns: 52px 52px 52px;
      grid-template-rows: 52px 20px 52px;
      gap: 3px;
    }
    .dpad.left-pad { left: 8px; }
    .dpad.right-pad { right: 8px; }

    .dpad .btn {
      display: flex; align-items: center; justify-content: center;
      background: rgba(255,255,255,0.15);
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 12px;
      font-size: 22px;
      color: #fff;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.1s;
      user-select: none;
    }
    .dpad .btn:active,
    .dpad .btn.pressed {
      background: rgba(255,255,255,0.4);
      transform: scale(0.93);
    }
    .dpad .btn-up    { grid-area: up; }
    .dpad .btn-left  { grid-area: left; }
    .dpad .btn-right { grid-area: right; }
    .dpad .btn-down  { grid-area: down; }

    /* P1Dãƒ‘ãƒƒãƒ‰ã¯é’ç³» */
    .left-pad .btn { border-color: rgba(79,195,247,0.5); background: rgba(79,195,247,0.15); }
    .left-pad .btn.pressed { background: rgba(79,195,247,0.5); }
    /* P2Dãƒ‘ãƒƒãƒ‰ã¯èµ¤ç³» */
    .right-pad .btn { border-color: rgba(239,154,154,0.5); background: rgba(239,154,154,0.15); }
    .right-pad .btn.pressed { background: rgba(239,154,154,0.5); }

    /* æ“ä½œèª¬æ˜ (PCå‘ã‘) */
    .hint {
      font-size: 0.75rem;
      color: #666;
      margin-top: 4px;
    }
    .hint .p1c { color: #4fc3f7; }
    .hint .p2c { color: #ef9a9a; }

    #restart-btn {
      margin-top: 10px;
      padding: 10px 30px;
      background: #00ff88;
      color: #1a1a2e;
      border: none;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      display: none;
    }

    /* ã‚¹ãƒãƒ›å‘ã‘: Dãƒ‘ãƒƒãƒ‰ã‚’å¤§ãã */
    @media (max-width: 500px) {
      .dpad {
        grid-template-columns: 58px 58px 58px;
        grid-template-rows: 58px 20px 58px;
      }
      .dpad .btn { font-size: 24px; border-radius: 14px; }
    }
  </style>
</head>
<body>
  <h1>âš½ 2äººã‚µãƒƒã‚«ãƒ¼</h1>
  <div class="score-board">
    <span class="p1-score" id="s1">0</span>
    <span class="vs">VS</span>
    <span class="p2-score" id="s2">0</span>
  </div>

  <div id="game-wrap">
    <canvas id="c"></canvas>

    <!-- P1 Dãƒ‘ãƒƒãƒ‰ (å·¦ä¸‹) -->
    <div class="dpad left-pad">
      <button class="btn btn-up"    data-key="w">â–²</button>
      <button class="btn btn-left"  data-key="a">â—€</button>
      <button class="btn btn-right" data-key="d">â–¶</button>
      <button class="btn btn-down"  data-key="s">â–¼</button>
    </div>

    <!-- P2 Dãƒ‘ãƒƒãƒ‰ (å³ä¸‹) -->
    <div class="dpad right-pad">
      <button class="btn btn-up"    data-key="ArrowUp">â–²</button>
      <button class="btn btn-left"  data-key="ArrowLeft">â—€</button>
      <button class="btn btn-right" data-key="ArrowRight">â–¶</button>
      <button class="btn btn-down"  data-key="ArrowDown">â–¼</button>
    </div>
  </div>

  <p class="hint">PC: <span class="p1c">P1=WASD</span> / <span class="p2c">P2=çŸ¢å°ã‚­ãƒ¼</span></p>
  <button id="restart-btn" onclick="restartGame()">ğŸ”„ ã‚‚ã†ä¸€åº¦</button>

<script>
// â”€â”€â”€ ã‚¿ãƒƒãƒ Dãƒ‘ãƒƒãƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const keys = {};

// å„ãƒœã‚¿ãƒ³ã«ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã‚’ä»˜ä¸
document.querySelectorAll('.dpad .btn').forEach(btn => {
  const k = btn.dataset.key;

  const press = (e) => {
    e.preventDefault();
    keys[k] = true;
    btn.classList.add('pressed');
  };
  const release = (e) => {
    e.preventDefault();
    keys[k] = false;
    btn.classList.remove('pressed');
  };

  btn.addEventListener('touchstart', press, { passive: false });
  btn.addEventListener('touchend', release, { passive: false });
  btn.addEventListener('touchcancel', release, { passive: false });
  // PC ã‚¯ãƒªãƒƒã‚¯å¯¾å¿œ
  btn.addEventListener('mousedown', press);
  btn.addEventListener('mouseup', release);
  btn.addEventListener('mouseleave', release);
});

// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰
window.addEventListener('keydown', e => {
  keys[e.key] = true;
  if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' '].includes(e.key)) e.preventDefault();
  if (e.key === ' ' && gameOver) restartGame();
});
window.addEventListener('keyup', e => { keys[e.key] = false; });

// â”€â”€â”€ Canvas ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const W = 800, H = 500;
canvas.width = W;
canvas.height = H;

// â”€â”€â”€ å®šæ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GOAL_W = 12, GOAL_H = 130, GOAL_Y = (H - GOAL_H) / 2;
const P_R = 20, P_SPEED = 4.5, BALL_R = 14, WIN_SCORE = 5;
const GOAL_PAUSE = 90;

// â”€â”€â”€ çŠ¶æ…‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let score = [0, 0];
let goalAnim = 0, goalTeam = -1;
let gameOver = false, winner = -1;
let p1, p2, ball;

function resetPositions() {
  p1   = { x: 200, y: H/2, vx: 0, vy: 0, color: '#4fc3f7', shadow: '#0288d1' };
  p2   = { x: W-200, y: H/2, vx: 0, vy: 0, color: '#ef9a9a', shadow: '#c62828' };
  ball = { x: W/2, y: H/2, vx: 0, vy: 0 };
  goalAnim = 0;
}

function restartGame() {
  score = [0, 0];
  gameOver = false; winner = -1;
  document.getElementById('s1').textContent = '0';
  document.getElementById('s2').textContent = '0';
  document.getElementById('restart-btn').style.display = 'none';
  resetPositions();
  ball.vx = (Math.random() > 0.5 ? 1 : -1) * 3;
  ball.vy = (Math.random() - 0.5) * 3;
}

resetPositions();
ball.vx = 3; ball.vy = -1;

// â”€â”€â”€ ç‰©ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function dist(a, b) { return Math.hypot(a.x - b.x, a.y - b.y); }

function circleCollide(a, ra, b, rb) {
  const d = dist(a, b);
  if (d < ra + rb && d > 0) {
    const nx = (b.x - a.x) / d, ny = (b.y - a.y) / d;
    const ov = ra + rb - d;
    b.x += nx * ov * 0.5; b.y += ny * ov * 0.5;
    a.x -= nx * ov * 0.5; a.y -= ny * ov * 0.5;
    const dot = (b.vx-a.vx)*nx + (b.vy-a.vy)*ny;
    if (dot < 0) {
      b.vx -= dot*nx; b.vy -= dot*ny;
      a.vx += dot*nx*0.3; a.vy += dot*ny*0.3;
    }
  }
}

function playerBallCollide(p, b) {
  const d = dist(p, b);
  if (d < P_R + BALL_R && d > 0) {
    const nx = (b.x - p.x) / d, ny = (b.y - p.y) / d;
    const ov = P_R + BALL_R - d;
    b.x += nx * ov; b.y += ny * ov;
    const spd = Math.hypot(p.vx, p.vy);
    const kick = Math.max(5, spd * 1.8 + 4);
    b.vx = nx * kick; b.vy = ny * kick;
  }
}

// â”€â”€â”€ ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function update() {
  if (gameOver) return;

  if (goalAnim > 0) {
    goalAnim--;
    if (goalAnim === 0) {
      resetPositions();
      ball.vx = (goalTeam === 0 ? -1 : 1) * 4;
      ball.vy = (Math.random() - 0.5) * 3;
    }
    return;
  }

  p1.vx = 0; p1.vy = 0;
  if (keys['w'] || keys['W']) p1.vy = -P_SPEED;
  if (keys['s'] || keys['S']) p1.vy =  P_SPEED;
  if (keys['a'] || keys['A']) p1.vx = -P_SPEED;
  if (keys['d'] || keys['D']) p1.vx =  P_SPEED;

  p2.vx = 0; p2.vy = 0;
  if (keys['ArrowUp'])    p2.vy = -P_SPEED;
  if (keys['ArrowDown'])  p2.vy =  P_SPEED;
  if (keys['ArrowLeft'])  p2.vx = -P_SPEED;
  if (keys['ArrowRight']) p2.vx =  P_SPEED;

  for (const p of [p1, p2]) {
    const spd = Math.hypot(p.vx, p.vy);
    if (spd > P_SPEED) { p.vx = p.vx/spd*P_SPEED; p.vy = p.vy/spd*P_SPEED; }
    p.x += p.vx; p.y += p.vy;
    p.x = Math.max(P_R, Math.min(W-P_R, p.x));
    p.y = Math.max(P_R, Math.min(H-P_R, p.y));
  }

  ball.x += ball.vx; ball.y += ball.vy;
  ball.vx *= 0.985; ball.vy *= 0.985;

  if (ball.y - BALL_R < 0)  { ball.y = BALL_R;    ball.vy *= -0.8; }
  if (ball.y + BALL_R > H)  { ball.y = H-BALL_R;  ball.vy *= -0.8; }
  if (ball.x - BALL_R < 0)  { ball.x = BALL_R;    ball.vx *= -0.8; }
  if (ball.x + BALL_R > W)  { ball.x = W-BALL_R;  ball.vx *= -0.8; }

  const bspd = Math.hypot(ball.vx, ball.vy);
  if (bspd > 18) { ball.vx = ball.vx/bspd*18; ball.vy = ball.vy/bspd*18; }

  playerBallCollide(p1, ball);
  playerBallCollide(p2, ball);
  circleCollide(p1, P_R, p2, P_R);

  // ã‚´ãƒ¼ãƒ«åˆ¤å®š
  if (ball.x - BALL_R < GOAL_W && ball.y > GOAL_Y && ball.y < GOAL_Y+GOAL_H) {
    score[1]++; document.getElementById('s2').textContent = score[1];
    goalTeam = 1; goalAnim = GOAL_PAUSE;
    if (score[1] >= WIN_SCORE) endGame(1);
    return;
  }
  if (ball.x + BALL_R > W-GOAL_W && ball.y > GOAL_Y && ball.y < GOAL_Y+GOAL_H) {
    score[0]++; document.getElementById('s1').textContent = score[0];
    goalTeam = 0; goalAnim = GOAL_PAUSE;
    if (score[0] >= WIN_SCORE) endGame(0);
    return;
  }
}

function endGame(w) {
  winner = w; gameOver = true;
  document.getElementById('restart-btn').style.display = 'inline-block';
}

// â”€â”€â”€ æç”» â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawField() {
  ctx.fillStyle = '#2d7a2d'; ctx.fillRect(0,0,W,H);
  for (let i = 0; i < 8; i++) {
    ctx.fillStyle = i%2===0 ? 'rgba(0,0,0,0.05)' : 'rgba(255,255,255,0.03)';
    ctx.fillRect(i*(W/8),0,W/8,H);
  }
  ctx.strokeStyle = 'rgba(255,255,255,0.8)'; ctx.lineWidth = 2;
  ctx.strokeRect(1,1,W-2,H-2);
  ctx.beginPath(); ctx.moveTo(W/2,0); ctx.lineTo(W/2,H); ctx.stroke();
  ctx.beginPath(); ctx.arc(W/2,H/2,60,0,Math.PI*2); ctx.stroke();
  ctx.fillStyle='rgba(255,255,255,0.8)'; ctx.beginPath(); ctx.arc(W/2,H/2,3,0,Math.PI*2); ctx.fill();
  ctx.strokeRect(GOAL_W,H/2-90,80,180);
  ctx.strokeRect(W-GOAL_W-80,H/2-90,80,180);

  for (const [gx,dir] of [[0,1],[W-GOAL_W,-1]]) {
    ctx.fillStyle='#eee'; ctx.fillRect(gx,GOAL_Y,GOAL_W,GOAL_H);
    ctx.strokeStyle='#999'; ctx.lineWidth=1.5; ctx.strokeRect(gx,GOAL_Y,GOAL_W,GOAL_H);
    ctx.strokeStyle='rgba(255,255,255,0.2)'; ctx.lineWidth=0.5;
    for(let y=GOAL_Y;y<GOAL_Y+GOAL_H;y+=12){ctx.beginPath();ctx.moveTo(gx,y);ctx.lineTo(gx+GOAL_W,y);ctx.stroke();}
    for(let x=gx;x<=gx+GOAL_W;x+=6){ctx.beginPath();ctx.moveTo(x,GOAL_Y);ctx.lineTo(x,GOAL_Y+GOAL_H);ctx.stroke();}
  }
}

function drawPlayer(p, label) {
  ctx.beginPath(); ctx.ellipse(p.x,p.y+P_R-2,P_R*0.9,6,0,0,Math.PI*2);
  ctx.fillStyle='rgba(0,0,0,0.3)'; ctx.fill();
  const g = ctx.createRadialGradient(p.x-5,p.y-5,2,p.x,p.y,P_R);
  g.addColorStop(0,p.color); g.addColorStop(1,p.shadow);
  ctx.beginPath(); ctx.arc(p.x,p.y,P_R,0,Math.PI*2);
  ctx.fillStyle=g; ctx.fill();
  ctx.strokeStyle='rgba(255,255,255,0.5)'; ctx.lineWidth=2; ctx.stroke();
  ctx.fillStyle='#fff'; ctx.font='bold 11px sans-serif';
  ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText(label,p.x,p.y);
}

function drawBall() {
  ctx.beginPath(); ctx.ellipse(ball.x,ball.y+BALL_R-2,BALL_R*0.8,5,0,0,Math.PI*2);
  ctx.fillStyle='rgba(0,0,0,0.3)'; ctx.fill();
  const g = ctx.createRadialGradient(ball.x-3,ball.y-4,1,ball.x,ball.y,BALL_R);
  g.addColorStop(0,'#fff'); g.addColorStop(0.5,'#ddd'); g.addColorStop(1,'#333');
  ctx.beginPath(); ctx.arc(ball.x,ball.y,BALL_R,0,Math.PI*2);
  ctx.fillStyle=g; ctx.fill();
  ctx.strokeStyle='rgba(50,50,50,0.6)'; ctx.lineWidth=1;
  [0,72,144,216,288].forEach(a=>{
    const r = a*Math.PI/180;
    ctx.beginPath(); ctx.arc(ball.x,ball.y,BALL_R*0.5,r,r+72*Math.PI/180); ctx.stroke();
  });
}

function drawGoalAnim() {
  if (goalAnim<=0) return;
  const t = goalAnim/GOAL_PAUSE;
  ctx.fillStyle=`rgba(0,0,0,${Math.min(1,t*2)*0.4})`; ctx.fillRect(0,0,W,H);
  ctx.save();
  const sc = 1+(1-t)*0.5;
  ctx.translate(W/2,H/2); ctx.scale(sc,sc);
  ctx.font='bold 80px sans-serif'; ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.strokeStyle=goalTeam===0?'#0288d1':'#c62828'; ctx.lineWidth=6;
  ctx.strokeText('GOAL! âš½',0,0);
  ctx.fillStyle=goalTeam===0?'#4fc3f7':'#ef9a9a'; ctx.fillText('GOAL! âš½',0,0);
  ctx.font='bold 30px sans-serif'; ctx.fillStyle='#fff';
  ctx.fillText(`P${goalTeam+1} å¾—ç‚¹ï¼`,0,70);
  ctx.restore();
}

function drawGameOver() {
  if (!gameOver) return;
  ctx.fillStyle='rgba(0,0,0,0.65)'; ctx.fillRect(0,0,W,H);
  ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.font='bold 70px sans-serif';
  ctx.fillStyle=winner===0?'#4fc3f7':'#ef9a9a';
  ctx.strokeStyle='#000'; ctx.lineWidth=4;
  ctx.strokeText(`P${winner+1} å„ªå‹ï¼ ğŸ†`,W/2,H/2-20);
  ctx.fillText(`P${winner+1} å„ªå‹ï¼ ğŸ†`,W/2,H/2-20);
  ctx.font='bold 24px sans-serif'; ctx.fillStyle='#fff';
  ctx.fillText('ãƒœã‚¿ãƒ³ã§å†æˆ¦',W/2,H/2+45);
}

function loop() {
  update();
  drawField();
  drawPlayer(p1,'P1'); drawPlayer(p2,'P2');
  drawBall();
  if (goalAnim>0) drawGoalAnim();
  if (gameOver) drawGameOver();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
